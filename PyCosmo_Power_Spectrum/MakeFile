# Define the virtual environment directory
VENV := venv

# Define the folder where .param files are stored
PARAM_FILE_DIR := PyCosmo_Power_Spectrum/input_parameters

# Default parameter file (inside the 'params' folder)
PARAM_FILE := pycosmo_input_32.param

# Default target
all: install run

# Create a virtual environment with Python 3.9
venv:
	@echo "Setting up virtual environment with Python 3.9..."
	@if [ ! -d "$(VENV)" ]; then \
		python3.9 -m venv $(VENV); \
	fi

# Install dependencies from requirements.txt
install: venv
	$(VENV)/bin/pip install -r requirements.txt

# Run the main script
run:
	$(VENV)/bin/python custom_power_spectrum.py $(PARAM_FILE)

# Run tests
test:
	$(VENV)/bin/pytest tests/

# Clean up virtual environment and compiled Python files
clean:
	rm -rf $(VENV) __pycache__
	find . -name "*.pyc" -delete
